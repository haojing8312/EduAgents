# ä¸šåŠ¡ç©¿è¶Šæµ‹è¯• - ä½¿ç”¨è¯´æ˜

## ğŸ“‹ æ¦‚è¿°

ä¸šåŠ¡ç©¿è¶Šæµ‹è¯•è„šæœ¬ç”¨äºæ¨¡æ‹Ÿå‰ç«¯ä¸šåŠ¡æµç¨‹ï¼Œæµ‹è¯•åç«¯APIæ¥å£çš„å®Œæ•´æ€§å’Œå¯ç”¨æ€§ã€‚è¿™æ˜¯ä¸€ä¸ªå…¨é¢çš„ç«¯åˆ°ç«¯æµ‹è¯•ï¼Œç¡®ä¿ç³»ç»Ÿåœ¨å®é™…ä¸šåŠ¡åœºæ™¯ä¸‹èƒ½æ­£å¸¸å·¥ä½œã€‚

## ğŸ¯ æµ‹è¯•è¦†ç›–èŒƒå›´

### æ ¸å¿ƒä¸šåŠ¡æµç¨‹
1. **ç³»ç»Ÿå¥åº·æ£€æŸ¥** - éªŒè¯æœåŠ¡åŸºç¡€å¯ç”¨æ€§
2. **ç³»ç»Ÿèƒ½åŠ›æŸ¥è¯¢** - æµ‹è¯•æ™ºèƒ½ä½“èƒ½åŠ›æ¥å£
3. **æ¨¡æ¿åŠŸèƒ½æµ‹è¯•** - æµ‹è¯•è¯¾ç¨‹æ¨¡æ¿ç›¸å…³æ“ä½œ
4. **è¯¾ç¨‹è®¾è®¡ä¼šè¯æµç¨‹** - å®Œæ•´çš„PBLè¯¾ç¨‹è®¾è®¡æµç¨‹
5. **è¯¾ç¨‹è¿­ä»£ä¼˜åŒ–** - åŸºäºåé¦ˆçš„è¯¾ç¨‹æ”¹è¿›
6. **è¯¾ç¨‹å¯¼å‡ºåŠŸèƒ½** - å¤šæ ¼å¼å¯¼å‡ºæµ‹è¯•
7. **è´¨é‡æ£€æŸ¥åŠŸèƒ½** - è¯¾ç¨‹è´¨é‡è¯„ä¼°
8. **åä½œåŠŸèƒ½æµ‹è¯•** - å¤šç”¨æˆ·åä½œåœºæ™¯
9. **æ™ºèƒ½ä½“æ€§èƒ½æŒ‡æ ‡** - ç³»ç»Ÿç›‘æ§æŒ‡æ ‡
10. **ä¼šè¯æ¸…ç†** - èµ„æºç®¡ç†æµ‹è¯•

### APIæ¥å£è¦†ç›–
- **æ™ºèƒ½ä½“ç›¸å…³**: `/api/v1/agents/*`
- **æ¨¡æ¿ç›¸å…³**: `/api/v1/templates/*`
- **è´¨é‡æ£€æŸ¥**: `/api/v1/quality/*`
- **åä½œåŠŸèƒ½**: `/api/v1/collaboration/*`
- **å¥åº·æ£€æŸ¥**: `/api/health`

## ğŸš€ å¿«é€Ÿä½¿ç”¨

### æ–¹å¼1: é€šè¿‡ä¸»æµ‹è¯•è„šæœ¬ï¼ˆæ¨èï¼‰
```bash
# è¿›å…¥åç«¯ç›®å½•
cd backend

# è¿è¡Œä¸šåŠ¡æµç¨‹æµ‹è¯•
uv run scripts/test.py --business
```

### æ–¹å¼2: ç›´æ¥è¿è¡Œä¸šåŠ¡æµç¨‹æµ‹è¯•
```bash
# è¿›å…¥åç«¯ç›®å½•
cd backend

# ç›´æ¥è¿è¡Œä¸šåŠ¡æµç¨‹æµ‹è¯•ï¼ˆåŒ…å«æœåŠ¡å¯åŠ¨ï¼‰
uv run scripts/run_business_flow_test.py
```

### æ–¹å¼3: ç‹¬ç«‹æµ‹è¯•è„šæœ¬
```bash
# è¿›å…¥åç«¯ç›®å½•
cd backend

# å¦‚æœåç«¯æœåŠ¡å·²å¯åŠ¨ï¼Œå¯ç›´æ¥è¿è¡Œæµ‹è¯•
uv run python tests/integration/test_business_flow.py
```

## ğŸ”§ é…ç½®é€‰é¡¹

### ç¯å¢ƒå˜é‡
```bash
# æµ‹è¯•ç›®æ ‡åœ°å€ï¼ˆé»˜è®¤: http://localhost:8000ï¼‰
export TEST_BASE_URL="http://localhost:8000"

# æ•°æ®åº“é…ç½®ï¼ˆæµ‹è¯•ç¯å¢ƒï¼‰
export DATABASE_URL="sqlite:///./test.db"
export REDIS_URL="redis://localhost:6379/1"

# AI APIå¯†é’¥ï¼ˆå¦‚æœéœ€è¦ï¼‰
export OPENAI_API_KEY="your_key"
export ANTHROPIC_API_KEY="your_key"
```

### æµ‹è¯•é…ç½®
æµ‹è¯•è„šæœ¬æ”¯æŒä»¥ä¸‹é…ç½®ï¼š
- è¶…æ—¶è®¾ç½®: 60ç§’è¯·æ±‚è¶…æ—¶
- å¥åº·æ£€æŸ¥: 30æ¬¡é‡è¯•ï¼Œ2ç§’é—´éš”
- æ¨¡æ‹Ÿç”¨æˆ·è®¤è¯: ä½¿ç”¨Bearer token
- æµ‹è¯•æ•°æ®: ä½¿ç”¨fakerç”Ÿæˆä¸­æ–‡æµ‹è¯•æ•°æ®

## ğŸ“Š æµ‹è¯•æŠ¥å‘Š

### æŠ¥å‘Šæ ¼å¼
æµ‹è¯•å®Œæˆåä¼šç”ŸæˆJSONæ ¼å¼çš„è¯¦ç»†æŠ¥å‘Šï¼Œä¿å­˜åœ¨ `tests/integration/test_reports/` ç›®å½•ä¸‹ã€‚

æŠ¥å‘ŠåŒ…å«ï¼š
```json
{
  "summary": {
    "total_tests": 10,
    "successful_tests": 8,
    "failed_tests": 2,
    "success_rate": "80.0%",
    "test_time": "2024-01-01T12:00:00"
  },
  "results": {
    "æµ‹è¯•åç§°": {
      "success": true,
      "timestamp": "2024-01-01T12:00:00",
      "details": {...}
    }
  },
  "session_data": {...},
  "execution_time_seconds": 45.2
}
```

### æ§åˆ¶å°è¾“å‡º
æµ‹è¯•æ‰§è¡Œè¿‡ç¨‹ä¸­ä¼šå®æ—¶æ˜¾ç¤ºï¼š
- âœ… æˆåŠŸçš„æµ‹è¯•æ­¥éª¤
- âŒ å¤±è´¥çš„æµ‹è¯•æ­¥éª¤
- ğŸ“‹ å½“å‰æ‰§è¡Œçš„æµ‹è¯•åç§°
- ğŸ‰ æœ€ç»ˆæµ‹è¯•ç»“æœæ±‡æ€»

## ğŸ› ï¸ æµ‹è¯•æ¶æ„

### æ ¸å¿ƒç±»
```python
class BusinessFlowTester:
    """ä¸šåŠ¡æµç¨‹æµ‹è¯•å™¨"""

    def __init__(self, base_url: str = "http://localhost:8000")
    async def wait_and_check_health() -> bool
    async def test_course_design_session_flow() -> bool
    async def run_complete_business_flow() -> Dict[str, Any]
```

### æµ‹è¯•æ–¹æ³•
æ¯ä¸ªæµ‹è¯•æ–¹æ³•è´Ÿè´£ç‰¹å®šçš„ä¸šåŠ¡åœºæ™¯ï¼š
- `test_root_endpoint()` - åŸºç¡€è¿é€šæ€§
- `test_system_capabilities()` - ç³»ç»Ÿèƒ½åŠ›
- `test_course_design_session_flow()` - æ ¸å¿ƒä¸šåŠ¡æµç¨‹
- `test_course_iteration_flow()` - è¿­ä»£ä¼˜åŒ–
- `test_course_export_flow()` - å¯¼å‡ºåŠŸèƒ½
- ç­‰...

## ğŸ” æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. æœåŠ¡å¯åŠ¨å¤±è´¥
```
âŒ åç«¯æœåŠ¡å™¨å¯åŠ¨å¤±è´¥
```
**è§£å†³æ–¹æ¡ˆ**:
- æ£€æŸ¥ç«¯å£8000æ˜¯å¦è¢«å ç”¨
- ç¡®è®¤uvç¯å¢ƒé…ç½®æ­£ç¡®
- æŸ¥çœ‹é”™è¯¯æ—¥å¿—æ’æŸ¥å…·ä½“é—®é¢˜

#### 2. å¥åº·æ£€æŸ¥è¶…æ—¶
```
âŒ æœåŠ¡å¥åº·æ£€æŸ¥å¤±è´¥ï¼Œæµ‹è¯•ç»ˆæ­¢
```
**è§£å†³æ–¹æ¡ˆ**:
- å¢åŠ å¥åº·æ£€æŸ¥ç­‰å¾…æ—¶é—´
- æ£€æŸ¥ç½‘ç»œè¿æ¥
- ç¡®è®¤æ•°æ®åº“å’ŒRedisæœåŠ¡å¯ç”¨

#### 3. APIè®¤è¯å¤±è´¥
```
âŒ 401 Unauthorized
```
**è§£å†³æ–¹æ¡ˆ**:
- æ£€æŸ¥è®¤è¯ä¸­é—´ä»¶é…ç½®
- ç¡®è®¤æµ‹è¯•ç”¨çš„mock tokenæœ‰æ•ˆ
- è°ƒæ•´è®¤è¯é€»è¾‘ä»¥æ”¯æŒæµ‹è¯•ç¯å¢ƒ

#### 4. æ•°æ®åº“è¿æ¥å¤±è´¥
```
âŒ 500 Internal Server Error - Database connection failed
```
**è§£å†³æ–¹æ¡ˆ**:
- æ£€æŸ¥DATABASE_URLç¯å¢ƒå˜é‡
- ç¡®è®¤æ•°æ®åº“æœåŠ¡è¿è¡Œæ­£å¸¸
- è¿è¡Œæ•°æ®åº“è¿ç§»

### è°ƒè¯•æŠ€å·§

#### 1. å¯ç”¨è¯¦ç»†æ—¥å¿—
```bash
export LOG_LEVEL=DEBUG
uv run scripts/test.py --business
```

#### 2. å•ç‹¬æµ‹è¯•ç‰¹å®šåŠŸèƒ½
ä¿®æ”¹ `test_business_flow.py` ä¸­çš„æµ‹è¯•æµç¨‹ï¼Œæ³¨é‡Šæ‰ä¸éœ€è¦çš„æµ‹è¯•æ­¥éª¤ã€‚

#### 3. æ£€æŸ¥APIå“åº”
åœ¨æµ‹è¯•æ–¹æ³•ä¸­æ·»åŠ è°ƒè¯•ä¿¡æ¯ï¼š
```python
print(f"Response status: {response.status_code}")
print(f"Response body: {response.text}")
```

#### 4. æ‰‹åŠ¨å¯åŠ¨åç«¯æœåŠ¡
```bash
# ç»ˆç«¯1: å¯åŠ¨åç«¯æœåŠ¡
cd backend
uv run uvicorn app.main:app --reload

# ç»ˆç«¯2: è¿è¡Œæµ‹è¯•
cd backend
uv run python tests/integration/test_business_flow.py
```

## ğŸ¯ æœ€ä½³å®è·µ

### 1. å®šæœŸæ‰§è¡Œ
å»ºè®®åœ¨ä»¥ä¸‹æƒ…å†µæ‰§è¡Œä¸šåŠ¡ç©¿è¶Šæµ‹è¯•ï¼š
- é‡è¦åŠŸèƒ½å¼€å‘å®Œæˆå
- ä»£ç åˆå¹¶åˆ°ä¸»åˆ†æ”¯å‰
- å‘å¸ƒæ–°ç‰ˆæœ¬å‰
- å®šæœŸçš„å›å½’æµ‹è¯•

### 2. CI/CDé›†æˆ
å¯ä»¥å°†æµ‹è¯•é›†æˆåˆ°CI/CDæµæ°´çº¿ï¼š
```yaml
# .github/workflows/backend-test.yml
- name: Run Business Flow Tests
  run: |
    cd backend
    uv run scripts/test.py --business
```

### 3. æµ‹è¯•æ•°æ®ç®¡ç†
- ä½¿ç”¨fakerç”Ÿæˆä¸€è‡´çš„æµ‹è¯•æ•°æ®
- æ¯æ¬¡æµ‹è¯•åæ¸…ç†ä¼šè¯å’Œä¸´æ—¶æ•°æ®
- ä½¿ç”¨ç‹¬ç«‹çš„æµ‹è¯•æ•°æ®åº“

### 4. ç»“æœç›‘æ§
- å®šæœŸåˆ†ææµ‹è¯•æŠ¥å‘Š
- è·Ÿè¸ªæˆåŠŸç‡è¶‹åŠ¿
- åŠæ—¶ä¿®å¤å¤±è´¥çš„æµ‹è¯•ç”¨ä¾‹

## ğŸ“ˆ æ€§èƒ½åŸºå‡†

### é¢„æœŸæ‰§è¡Œæ—¶é—´
- å®Œæ•´ä¸šåŠ¡æµç¨‹æµ‹è¯•: 30-60ç§’
- æœåŠ¡å¯åŠ¨ç­‰å¾…: 5-10ç§’
- å•ä¸ªAPIæµ‹è¯•: 1-5ç§’

### èµ„æºæ¶ˆè€—
- å†…å­˜ä½¿ç”¨: < 200MB
- ç£ç›˜ç©ºé—´: < 10MBï¼ˆæ—¥å¿—å’ŒæŠ¥å‘Šï¼‰
- ç½‘ç»œè¯·æ±‚: ~20-30ä¸ªHTTPè¯·æ±‚

## ğŸ¤ è´¡çŒ®æŒ‡å—

### æ·»åŠ æ–°æµ‹è¯•
1. åœ¨ `BusinessFlowTester` ç±»ä¸­æ·»åŠ æ–°çš„æµ‹è¯•æ–¹æ³•
2. åœ¨ `run_complete_business_flow` ä¸­æ³¨å†Œæµ‹è¯•
3. æ›´æ–°æ–‡æ¡£è¯´æ˜

### æµ‹è¯•æ–¹æ³•è§„èŒƒ
```python
async def test_new_feature(self) -> bool:
    """æµ‹è¯•æ–°åŠŸèƒ½"""
    try:
        # æµ‹è¯•é€»è¾‘
        response = await self.client.get(f"{self.base_url}/api/v1/new-feature")
        success = response.status_code == 200

        self.log_test_result("æ–°åŠŸèƒ½æµ‹è¯•", success, {
            "status_code": response.status_code
        })
        return success

    except Exception as e:
        self.log_test_result("æ–°åŠŸèƒ½æµ‹è¯•", False, {"error": str(e)})
        return False
```

---

*æ›´æ–°æ—¶é—´: 2024å¹´9æœˆ16æ—¥*
*ç‰ˆæœ¬: v1.0.0*